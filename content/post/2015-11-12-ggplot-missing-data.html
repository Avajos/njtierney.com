---
title: "ggplot your missing data"
date: "2015-11-12"
categories:
- rstats
- Missing Data
- rbloggers
slug: ggplot-missing-data
---



<p>Visualising missing data is important when analysing a dataset. I wanted to make a plot of the presence/absence in a dataset. One package, <a href="https://cran.r-project.org/web/packages/Amelia/index.html"><code>Amelia</code></a> provides a function to do this, but I don’t like the way it looks. So I made a ggplot version of what it did.</p>
<p>Let’s make a dataset using the awesome <a href="https://github.com/trinker/wakefield">wakefield package</a>, and add random missingness.</p>
<pre class="r"><code>library(dplyr)
library(wakefield)
df &lt;- 
  r_data_frame(
  n = 30,
  id,
  race,
  age,
  sex,
  hour,
  iq,
  height,
  died,
  Scoring = rnorm,
  Smoker = valid
  ) %&gt;%
  r_na(prob=.4)</code></pre>
<p>This is what the Amelia package produces by default:</p>
<pre class="r"><code>library(Amelia)

missmap(df)</code></pre>
<p><img src="/post/2015-11-12-ggplot-missing-data_files/figure-html/unnamed-chunk-2-1.png" width="1800" /></p>
<p>And let’s explore the missing data using my own ggplot function:</p>
<pre class="r"><code># A function that plots missingness
# requires `reshape2`

library(reshape2)
library(ggplot2)

ggplot_missing &lt;- function(x){
  
  x %&gt;% 
    is.na %&gt;%
    melt %&gt;%
    ggplot(data = .,
           aes(x = Var2,
               y = Var1)) +
    geom_raster(aes(fill = value)) +
    scale_fill_grey(name = &quot;&quot;,
                    labels = c(&quot;Present&quot;,&quot;Missing&quot;)) +
    theme_minimal() + 
    theme(axis.text.x  = element_text(angle=45, vjust=0.5)) + 
    labs(x = &quot;Variables in Dataset&quot;,
         y = &quot;Rows / observations&quot;)
}</code></pre>
<p>Let’s test it out</p>
<pre class="r"><code>ggplot_missing(df)</code></pre>
<p><img src="/post/2015-11-12-ggplot-missing-data_files/figure-html/unnamed-chunk-4-1.png" width="1800" /></p>
<p>It’s much cleaner, and easier to interpret.</p>
<p>This function, and others, is available in the <a href="https://github.com/tierneyn/neato">neato package</a>, where I store a bunch of functions I think are neat.</p>
<p>Quick note - there used to be a function, <code>missing.pattern.plot</code> in the package <code>mi</code> <a href="http://www.inside-r.org/packages/cran/mi/docs/missing.pattern.plot" class="uri">http://www.inside-r.org/packages/cran/mi/docs/missing.pattern.plot</a>. However, it doesn’t appear to exist anymore. This is a shame, as it was a really nifty plot, that clustered the groups of missingness. In the future, maybe I can rebuild what <code>missing.pattern.plot</code> once did. Perhaps in the future I can include this sort of thing in the <a href="https://github.com/tierneyn/mex"><code>mex</code> package</a>.</p>
<p>As another aside - if anyone knows how I can improve the image quality of the plots, I’m all ears. I’ve tried changing the dpi, changing it to pdf, png, svg, and even svglite but they all haven’t really solved the problem.</p>
<p>Thoughts? Write them below.</p>
